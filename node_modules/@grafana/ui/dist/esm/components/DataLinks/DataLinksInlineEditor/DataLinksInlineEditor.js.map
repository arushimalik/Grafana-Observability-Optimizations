{"version":3,"file":"DataLinksInlineEditor.js","sources":["../../../../../src/components/DataLinks/DataLinksInlineEditor/DataLinksInlineEditor.tsx"],"sourcesContent":["import { css } from '@emotion/css';\nimport { DragDropContext, Droppable, DropResult } from '@hello-pangea/dnd';\nimport { cloneDeep } from 'lodash';\nimport { ReactNode, useEffect, useState } from 'react';\n\nimport { DataFrame, DataLink, GrafanaTheme2, VariableSuggestion } from '@grafana/data';\n\nimport { useStyles2 } from '../../../themes';\nimport { Button } from '../../Button';\nimport { Modal } from '../../Modal/Modal';\n\nimport { DataLinkEditorModalContent } from './DataLinkEditorModalContent';\nimport { DataLinksListItem } from './DataLinksListItem';\n\ninterface DataLinksInlineEditorProps {\n  links?: DataLink[];\n  onChange: (links: DataLink[]) => void;\n  getSuggestions: () => VariableSuggestion[];\n  data: DataFrame[];\n  showOneClick?: boolean;\n}\n\nexport const DataLinksInlineEditor = ({\n  links,\n  onChange,\n  getSuggestions,\n  data,\n  showOneClick = false,\n}: DataLinksInlineEditorProps) => {\n  const [editIndex, setEditIndex] = useState<number | null>(null);\n  const [isNew, setIsNew] = useState(false);\n\n  const [linksSafe, setLinksSafe] = useState<DataLink[]>([]);\n\n  useEffect(() => {\n    setLinksSafe(links ?? []);\n  }, [links]);\n\n  const styles = useStyles2(getDataLinksInlineEditorStyles);\n  const isEditing = editIndex !== null;\n\n  const onDataLinkChange = (index: number, link: DataLink) => {\n    if (isNew) {\n      if (link.title.trim() === '' && link.url.trim() === '') {\n        setIsNew(false);\n        setEditIndex(null);\n        return;\n      } else {\n        setEditIndex(null);\n        setIsNew(false);\n      }\n    }\n    const update = cloneDeep(linksSafe);\n    update[index] = link;\n    onChange(update);\n    setEditIndex(null);\n  };\n\n  const onDataLinkAdd = () => {\n    let update = cloneDeep(linksSafe);\n    setEditIndex(update.length);\n    setIsNew(true);\n  };\n\n  const onDataLinkCancel = (index: number) => {\n    if (isNew) {\n      setIsNew(false);\n    }\n    setEditIndex(null);\n  };\n\n  const onDataLinkRemove = (index: number) => {\n    const update = cloneDeep(linksSafe);\n    update.splice(index, 1);\n    onChange(update);\n  };\n\n  const onDragEnd = (result: DropResult) => {\n    if (!links || !result.destination) {\n      return;\n    }\n\n    const update = cloneDeep(linksSafe);\n    const link = update[result.source.index];\n\n    update.splice(result.source.index, 1);\n    update.splice(result.destination.index, 0, link);\n\n    setLinksSafe(update);\n    onChange(update);\n  };\n\n  const renderFirstLink = (linkJSX: ReactNode, key: string) => {\n    if (showOneClick) {\n      return (\n        <div className={styles.oneClickOverlay} key={key}>\n          <span className={styles.oneClickSpan}>One-click link</span>\n          {linkJSX}\n        </div>\n      );\n    }\n    return linkJSX;\n  };\n\n  return (\n    <>\n      <DragDropContext onDragEnd={onDragEnd}>\n        <Droppable droppableId=\"sortable-links\" direction=\"vertical\">\n          {(provided) => (\n            <div className={styles.wrapper} ref={provided.innerRef} {...provided.droppableProps}>\n              {linksSafe.map((link, idx) => {\n                const key = `${link.title}/${idx}`;\n\n                const linkJSX = (\n                  <div className={styles.itemWrapper} key={key}>\n                    <DataLinksListItem\n                      key={key}\n                      index={idx}\n                      link={link}\n                      onChange={onDataLinkChange}\n                      onEdit={() => setEditIndex(idx)}\n                      onRemove={() => onDataLinkRemove(idx)}\n                      data={data}\n                      itemKey={key}\n                    />\n                  </div>\n                );\n\n                if (idx === 0) {\n                  return renderFirstLink(linkJSX, key);\n                }\n\n                return linkJSX;\n              })}\n              {provided.placeholder}\n            </div>\n          )}\n        </Droppable>\n      </DragDropContext>\n\n      {isEditing && editIndex !== null && (\n        <Modal\n          title=\"Edit link\"\n          isOpen={true}\n          closeOnBackdropClick={false}\n          onDismiss={() => {\n            onDataLinkCancel(editIndex);\n          }}\n        >\n          <DataLinkEditorModalContent\n            index={editIndex}\n            link={isNew ? { title: '', url: '' } : linksSafe[editIndex]}\n            data={data}\n            onSave={onDataLinkChange}\n            onCancel={onDataLinkCancel}\n            getSuggestions={getSuggestions}\n          />\n        </Modal>\n      )}\n\n      <Button size=\"sm\" icon=\"plus\" onClick={onDataLinkAdd} variant=\"secondary\" className={styles.button}>\n        Add link\n      </Button>\n    </>\n  );\n};\n\nconst getDataLinksInlineEditorStyles = (theme: GrafanaTheme2) => ({\n  wrapper: css({\n    marginBottom: theme.spacing(2),\n    display: 'flex',\n    flexDirection: 'column',\n  }),\n  oneClickOverlay: css({\n    height: 'auto',\n    border: `2px dashed ${theme.colors.text.link}`,\n    fontSize: 10,\n    color: theme.colors.text.primary,\n    marginBottom: theme.spacing(1),\n  }),\n  oneClickSpan: css({\n    padding: 10,\n    // Negates the padding on the span from moving the underlying link\n    marginBottom: -10,\n    display: 'inline-block',\n  }),\n  itemWrapper: css({\n    padding: '4px 8px 8px 8px',\n  }),\n  button: css({\n    marginLeft: theme.spacing(1),\n  }),\n});\n"],"names":[],"mappings":"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"}